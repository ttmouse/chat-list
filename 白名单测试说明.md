# 白名单功能测试说明

## 问题诊断

如果您遇到"添加了网址没有生效，刷新之后就没了"的问题，请按照以下步骤进行诊断：

## 步骤1：重新加载扩展

**重要：每次修改代码后，必须重新加载扩展！**

1. 打开 Chrome 浏览器
2. 访问 `chrome://extensions/`
3. 找到"话术助手"扩展
4. 点击"重新加载"按钮（🔄）
5. 确保扩展状态为"已启用"

## 步骤2：使用调试页面测试存储

1. 在浏览器中打开 `test-storage-debug.html` 文件
2. 点击"检查权限"按钮，确保所有权限都显示 ✓
3. 点击"检查存储"按钮，查看当前存储状态
4. 尝试"保存测试白名单"，然后"加载白名单"验证
5. 查看"操作日志"了解详细过程

## 步骤3：测试扩展popup

1. 点击浏览器工具栏中的扩展图标
2. 打开浏览器开发者工具（F12）
3. 在Console标签页中查看日志信息
4. 在白名单输入框中输入测试URL，如：`https://example.com/test`
5. 点击"添加网站"按钮
6. 观察Console中的日志输出

## 步骤4：验证持久化

1. 添加一个测试URL到白名单
2. 关闭popup窗口
3. 重新打开popup窗口
4. 检查白名单是否还在
5. 如果不在，查看Console中的错误信息

## 常见问题排查

### 问题1：权限不足
- 确保 `manifest.json` 中包含 `"storage"` 权限
- 重新加载扩展

### 问题2：存储API不可用
- 确保在扩展环境中测试（不是普通网页）
- 检查扩展是否正确安装和启用

### 问题3：数据没有保存
- 查看Console中的错误信息
- 使用调试页面测试存储功能
- 确保没有异步操作错误

### 问题4：UI没有更新
- 检查 `renderWhitelist()` 方法是否被调用
- 确保DOM元素ID正确
- 查看是否有JavaScript错误

## 调试技巧

1. **使用Console日志**：所有关键操作都会在Console中输出日志
2. **检查存储**：使用 `chrome://extensions/` → 点击扩展详情 → "检查视图：弹出式窗口"
3. **手动检查存储**：在Console中运行 `chrome.storage.local.get(null).then(console.log)`
4. **清空存储**：在Console中运行 `chrome.storage.local.clear()`

## 预期行为

正常情况下：
1. 添加URL后，立即在白名单列表中显示
2. 关闭并重新打开popup，URL仍然存在
3. Console中显示保存和加载的详细日志
4. 在调试页面中可以看到存储的数据

如果以上步骤都正常，但问题仍然存在，请提供Console中的错误信息以便进一步诊断。