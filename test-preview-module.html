<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>预览模块测试</title>
    <link rel="stylesheet" href="content.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .mock-script-item {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            cursor: pointer;
            background: white;
        }
        .mock-script-item:hover {
            background: #f8f9fa;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>预览模块测试页面</h1>
        
        <div id="status" class="status">准备测试...</div>
        
        <h2>测试步骤：</h2>
        <ol>
            <li>点击"初始化预览模块"按钮</li>
            <li>将鼠标悬停在模拟话术项上</li>
            <li>观察预览浮层是否正确显示</li>
            <li>测试鼠标移入移出预览浮层的行为</li>
        </ol>
        
        <div class="test-controls">
            <button class="test-button" onclick="initPreviewModule()">初始化预览模块</button>
            <button class="test-button" onclick="destroyPreviewModule()">销毁预览模块</button>
            <button class="test-button" onclick="testShowPreview()">测试显示预览</button>
            <button class="test-button" onclick="testHidePreview()">测试隐藏预览</button>
        </div>
        
        <h3>模拟话术列表：</h3>
        <div class="mock-script-item" 
             data-id="1" 
             data-title="欢迎语" 
             data-note="标准问候语" 
             data-content="您好，很高兴为您服务！有什么可以帮助您的吗？" 
             data-group-id="greeting"
             onmouseenter="showPreview(this)"
             onmouseleave="hidePreview()">
            <strong>欢迎语</strong><br>
            <small>您好，很高兴为您服务！有什么可以帮助您的吗？</small>
        </div>
        
        <div class="mock-script-item" 
             data-id="2" 
             data-title="产品介绍" 
             data-note="突出产品优势" 
             data-content="我们的产品具有以下特点：高质量、高性价比、优质服务。" 
             data-group-id="service"
             onmouseenter="showPreview(this)"
             onmouseleave="hidePreview()">
            <strong>产品介绍</strong><br>
            <small>我们的产品具有以下特点：高质量、高性价比、优质服务。</small>
        </div>
        
        <div class="mock-script-item" 
             data-id="3" 
             data-title="感谢语" 
             data-note="礼貌结束对话" 
             data-content="感谢您的咨询，祝您生活愉快！" 
             data-group-id="closing"
             onmouseenter="showPreview(this)"
             onmouseleave="hidePreview()">
            <strong>感谢语</strong><br>
            <small>感谢您的咨询，祝您生活愉快！</small>
        </div>
    </div>

    <!-- 模拟主界面容器 -->
    <div id="chat-list-widget" style="position: fixed; right: 20px; top: 100px; width: 300px; height: 400px; background: white; border: 1px solid #ddd; border-radius: 8px; display: none;">
        <div style="padding: 20px;">模拟主界面</div>
    </div>

    <script src="utils.js"></script>
    <script src="preview-module.js"></script>
    <script>
        let previewModule = null;
        let mockChatListWidget = null;
        
        // 模拟ChatListWidget
        function createMockChatListWidget() {
            const widget = document.getElementById('chat-list-widget');
            widget.style.display = 'block';
            
            return {
                widget: widget,
                groups: [
                    { id: 'greeting', name: '问候语', color: '#4CAF50' },
                    { id: 'service', name: '服务话术', color: '#2196F3' },
                    { id: 'closing', name: '结束语', color: '#FF9800' }
                ],
                scripts: [
                    { id: '1', title: '欢迎语', note: '标准问候语', content: '您好，很高兴为您服务！有什么可以帮助您的吗？', groupId: 'greeting' },
                    { id: '2', title: '产品介绍', note: '突出产品优势', content: '我们的产品具有以下特点：高质量、高性价比、优质服务。', groupId: 'service' },
                    { id: '3', title: '感谢语', note: '礼貌结束对话', content: '感谢您的咨询，祝您生活愉快！', groupId: 'closing' }
                ],
                showEditScriptModal: function(script) {
                    updateStatus('编辑按钮被点击，话术ID: ' + script.id, 'success');
                }
            };
        }
        
        function updateStatus(message, type = 'success') {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = 'status ' + type;
            console.log('[测试] ' + message);
        }
        
        function initPreviewModule() {
            try {
                if (previewModule) {
                    updateStatus('预览模块已存在，先销毁旧实例', 'error');
                    destroyPreviewModule();
                }
                
                mockChatListWidget = createMockChatListWidget();
                previewModule = new PreviewModule(mockChatListWidget);
                previewModule.createPreviewLayer();
                
                updateStatus('预览模块初始化成功！', 'success');
            } catch (error) {
                updateStatus('预览模块初始化失败: ' + error.message, 'error');
                console.error('初始化错误:', error);
            }
        }
        
        function destroyPreviewModule() {
            try {
                if (previewModule) {
                    previewModule.destroy();
                    previewModule = null;
                    updateStatus('预览模块已销毁', 'success');
                } else {
                    updateStatus('没有预览模块需要销毁', 'error');
                }
                
                if (mockChatListWidget && mockChatListWidget.widget) {
                    mockChatListWidget.widget.style.display = 'none';
                }
            } catch (error) {
                updateStatus('销毁预览模块失败: ' + error.message, 'error');
                console.error('销毁错误:', error);
            }
        }
        
        function showPreview(element) {
            if (!previewModule) {
                updateStatus('请先初始化预览模块', 'error');
                return;
            }
            
            try {
                previewModule.showPreview(element);
                updateStatus('显示预览: ' + element.dataset.title, 'success');
            } catch (error) {
                updateStatus('显示预览失败: ' + error.message, 'error');
                console.error('显示预览错误:', error);
            }
        }
        
        function hidePreview() {
            if (!previewModule) {
                return;
            }
            
            try {
                previewModule.hidePreview();
                updateStatus('隐藏预览', 'success');
            } catch (error) {
                updateStatus('隐藏预览失败: ' + error.message, 'error');
                console.error('隐藏预览错误:', error);
            }
        }
        
        function testShowPreview() {
            const firstItem = document.querySelector('.mock-script-item');
            if (firstItem) {
                showPreview(firstItem);
            } else {
                updateStatus('找不到测试项', 'error');
            }
        }
        
        function testHidePreview() {
            if (previewModule) {
                previewModule.forceHidePreview();
                updateStatus('强制隐藏预览', 'success');
            } else {
                updateStatus('请先初始化预览模块', 'error');
            }
        }
        
        // 页面加载完成后自动初始化
        window.addEventListener('load', function() {
            updateStatus('页面加载完成，可以开始测试', 'success');
        });
    </script>
</body>
</html>