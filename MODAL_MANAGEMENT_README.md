# æ¨¡æ€æ¡†ç®¡ç†æ¨¡å—è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¨¡å—æ¦‚è¿°

æ¨¡æ€æ¡†ç®¡ç†æ¨¡å—(`modal-management.js`)è´Ÿè´£å¤„ç†è¯æœ¯åŠ©æ‰‹æ’ä»¶ä¸­æ‰€æœ‰æ¨¡æ€æ¡†å’Œé¢æ¿çš„æ˜¾ç¤ºã€éšè—å’Œäº¤äº’é€»è¾‘ã€‚è¯¥æ¨¡å—å°†ç›¸å…³åŠŸèƒ½ä»ä¸»æ–‡ä»¶(`content.js`)ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œæé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ¨¡å—åŒ–ç¨‹åº¦ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. ç®¡ç†é¢æ¿æ§åˆ¶
- æ˜¾ç¤ºç®¡ç†é¢æ¿ (`showManagePanel`)
- éšè—ç®¡ç†é¢æ¿ (`hideManagePanel`)

### 2. æ¨¡æ€æ¡†ç®¡ç†
- æ˜¾ç¤ºæ·»åŠ è¯æœ¯æ¨¡æ€æ¡† (`showAddScriptModal`)
- éšè—æ·»åŠ è¯æœ¯æ¨¡æ€æ¡† (`hideAddScriptModal`)

### 3. æ’ä»¶ä¸»ç•Œé¢æ§åˆ¶
- æ˜¾ç¤ºæ’ä»¶ (`showWidget`)
- éšè—æ’ä»¶ (`hideWidget`)
- åˆ‡æ¢æ’ä»¶æ˜¾ç¤ºçŠ¶æ€ (`toggleWidget`)

### 4. è¡¨å•å¤„ç†
- å¡«å……åˆ†ç»„é€‰é¡¹ (`populateGroupOptions`)
- è¡¨å•éªŒè¯ (`validateModalForm`)
- æ–°å¢è¯æœ¯ä¿å­˜ (`saveNewScript`)

## ğŸ› ï¸ æ¨¡å—ç»“æ„

```javascript
/**
 * æ¨¡æ€æ¡†ç®¡ç†æ¨¡å—
 */
class ModalManagement {
  constructor(chatListWidget) {
    this.widget = chatListWidget;
  }

  // ç®¡ç†é¢æ¿ç›¸å…³æ–¹æ³•
  showManagePanel() { /* ... */ }
  hideManagePanel() { /* ... */ }

  // æ’ä»¶æ˜¾ç¤º/éšè—ç›¸å…³æ–¹æ³•
  toggleWidget() { /* ... */ }
  showWidget() { /* ... */ }
  hideWidget() { /* ... */ }

  // æ¨¡æ€æ¡†ç›¸å…³æ–¹æ³•
  showAddScriptModal() { /* ... */ }
  hideAddScriptModal() { /* ... */ }
  _createAddScriptModalHTML() { /* ... */ }

  // è¡¨å•ç›¸å…³æ–¹æ³•
  populateGroupOptions() { /* ... */ }
  bindModalEvents() { /* ... */ }
  _bindValidationEvents() { /* ... */ }
  validateModalForm() { /* ... */ }
  saveNewScript() { /* ... */ }
}
```

## ğŸ“ API å‚è€ƒ

### 1. æ„é€ å‡½æ•°

```javascript
/**
 * åˆ›å»ºæ¨¡æ€æ¡†ç®¡ç†å®ä¾‹
 * @param {ChatListWidget} chatListWidget - ä¸»æ’ä»¶å®ä¾‹
 */
constructor(chatListWidget)
```

### 2. ç®¡ç†é¢æ¿ç›¸å…³æ–¹æ³•

```javascript
/**
 * æ˜¾ç¤ºç®¡ç†é¢æ¿
 */
showManagePanel()

/**
 * éšè—ç®¡ç†é¢æ¿
 */
hideManagePanel()
```

### 3. æ’ä»¶æ˜¾ç¤ºæ§åˆ¶æ–¹æ³•

```javascript
/**
 * åˆ‡æ¢æ’ä»¶æ˜¾ç¤ºçŠ¶æ€
 */
toggleWidget()

/**
 * æ˜¾ç¤ºæ’ä»¶
 */
showWidget()

/**
 * éšè—æ’ä»¶
 */
hideWidget()
```

### 4. æ¨¡æ€æ¡†ç›¸å…³æ–¹æ³•

```javascript
/**
 * æ˜¾ç¤ºæ·»åŠ è¯æœ¯æ¨¡æ€æ¡†
 */
showAddScriptModal()

/**
 * éšè—æ·»åŠ è¯æœ¯æ¨¡æ€æ¡†
 */
hideAddScriptModal()

/**
 * åˆ›å»ºæ·»åŠ è¯æœ¯æ¨¡æ€æ¡†HTML (å†…éƒ¨æ–¹æ³•)
 * @returns {string} æ¨¡æ€æ¡†HTMLå­—ç¬¦ä¸²
 */
_createAddScriptModalHTML()
```

### 5. è¡¨å•ç›¸å…³æ–¹æ³•

```javascript
/**
 * å¡«å……åˆ†ç»„é€‰é¡¹
 */
populateGroupOptions()

/**
 * ç»‘å®šæ¨¡æ€æ¡†äº‹ä»¶
 */
bindModalEvents()

/**
 * ç»‘å®šè¡¨å•éªŒè¯äº‹ä»¶ (å†…éƒ¨æ–¹æ³•)
 */
_bindValidationEvents()

/**
 * éªŒè¯æ¨¡æ€æ¡†è¡¨å•
 * @returns {boolean} éªŒè¯æ˜¯å¦é€šè¿‡
 */
validateModalForm()

/**
 * ä¿å­˜æ–°è¯æœ¯
 */
saveNewScript()
```

## ğŸ“š ä½¿ç”¨ç¤ºä¾‹

### 1. æ¨¡å—åˆå§‹åŒ–

```javascript
// åœ¨ChatListWidgetç±»ä¸­æ·»åŠ åˆå§‹åŒ–æ–¹æ³•
initModalManagement() {
  if (window.ModalManagement) {
    this.modalManagement = new window.ModalManagement(this);
  } else {
    console.error('ModalManagement æ¨¡å—æœªåŠ è½½');
  }
}

// åœ¨init()æ–¹æ³•ä¸­è°ƒç”¨åˆå§‹åŒ–
async init() {
  // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
  this.initModalManagement();
  // ... å…¶ä»–åˆå§‹åŒ–ä»£ç  ...
}
```

### 2. è°ƒç”¨æ¨¡å—æ–¹æ³•

```javascript
// æ˜¾ç¤ºç®¡ç†é¢æ¿
showManagePanel() {
  if (this.modalManagement) {
    this.modalManagement.showManagePanel();
  } else {
    // é™çº§å¤„ç†...
  }
}
```

## ğŸš¨ é—®é¢˜æ’æŸ¥

### æ¨¡å—åŠ è½½é—®é¢˜

å¦‚æœç®¡ç†é¢æ¿æˆ–æ¨¡æ€æ¡†ä¸æ˜¾ç¤ºï¼Œå¯èƒ½æ˜¯ç”±äºä»¥ä¸‹åŸå› ï¼š

1. **æ¨¡å—æœªæ­£ç¡®åŠ è½½**: æ£€æŸ¥consoleæ˜¯å¦æœ‰"ModalManagement æ¨¡å—æœªåŠ è½½"çš„é”™è¯¯
2. **åŠ è½½é¡ºåºé”™è¯¯**: ç¡®è®¤`manifest.json`ä¸­çš„æ¨¡å—åŠ è½½é¡ºåºæ­£ç¡®
3. **DOMå…ƒç´ ä¸å­˜åœ¨**: æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ï¼ŒæŸ¥çœ‹æ˜¯å¦æŠ¥å‘Š"æ‰¾ä¸åˆ°ç®¡ç†é¢æ¿å…ƒç´ "ç­‰é”™è¯¯

### æ˜¾ç¤ºé—®é¢˜

å¦‚æœç®¡ç†é¢æ¿æ˜¾ç¤ºä½†æ ·å¼ä¸æ­£ç¡®ï¼š

1. **CSSæ ·å¼é—®é¢˜**: æ£€æŸ¥é¢æ¿å…ƒç´ çš„è®¡ç®—æ ·å¼
2. **å¤§å°ä¸ºé›¶**: æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰"ç®¡ç†é¢æ¿å°ºå¯¸ä¸º0"çš„è­¦å‘Š
3. **å¯è§æ€§è®¾ç½®**: ç¡®è®¤`visibility`å’Œ`display`å±æ€§è®¾ç½®æ­£ç¡®

## ğŸ”„ æ”¹è¿›å†å²

### v1.0.0 (å½“å‰ç‰ˆæœ¬)
- ğŸ‰ åˆå§‹ç‰ˆæœ¬
- âœ… ä»ä¸»æ–‡ä»¶åˆ†ç¦»æ¨¡æ€æ¡†å’Œç®¡ç†é¢æ¿é€»è¾‘
- âœ… å®ç°å®Œæ•´çš„APIæ¥å£
- âœ… ç¡®ä¿å‘åå…¼å®¹æ€§

### è®¡åˆ’æ”¹è¿›
- ğŸ”„ æ·»åŠ æ›´å¤šè‡ªå®šä¹‰æ¨¡æ€æ¡†æ ·å¼é€‰é¡¹
- ğŸ”„ å®ç°åŠ¨ç”»è¿‡æ¸¡æ•ˆæœ
- ğŸ”„ å¢å¼ºé”™è¯¯å¤„ç†å’Œæ—¥å¿—

## ğŸ“Œ æ³¨æ„äº‹é¡¹

1. æ¨¡æ€æ¡†ç®¡ç†æ¨¡å—ä¾èµ–äºDOMæ“ä½œï¼Œè°ƒç”¨å‰ç¡®ä¿DOMå·²åŠ è½½
2. æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½å®ç°äº†é™çº§å¤„ç†ï¼Œåœ¨æ¨¡å—æœªåŠ è½½æ—¶ä¸ä¼šå¯¼è‡´ç¨‹åºå´©æºƒ
3. æ¨¡å—çš„è®¾è®¡éµå¾ªäº†å•ä¸€èŒè´£åŸåˆ™ï¼Œä¸“æ³¨äºUIå±•ç¤ºå’Œäº¤äº’å¤„ç†
4. åœ¨ä¸å…¶ä»–æ¨¡å—äº¤äº’æ—¶ï¼Œé€šè¿‡ä¸»ç±»(ChatListWidget)å®ä¾‹è¿›è¡Œï¼Œé¿å…ç›´æ¥ä¾èµ– 