<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†é¢æ¿æµ‹è¯•</title>
    <link rel="stylesheet" href="content.css">
</head>
<body>
    <div id="chat-list-widget">
        <div class="widget-wrapper">
            <div class="widget-header">
                <span class="widget-title">è¯æœ¯åŠ©æ‰‹ <span class="version">v1.1.0</span></span>
                <div class="widget-controls">
                    <button class="btn-manage" title="ç®¡ç†è¯æœ¯">âš™ï¸</button>
                    <button class="btn-toggle" title="æ”¶èµ·/å±•å¼€">ğŸ“‹</button>
                    <button class="btn-close" title="å…³é—­">Ã—</button>
                </div>
            </div>
            <div class="widget-content">
                <div class="script-list">
                    <div class="script-item">
                        <div class="script-content">
                            <div class="script-title">æµ‹è¯•è¯æœ¯</div>
                            <div class="script-text">è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯æœ¯å†…å®¹</div>
                        </div>
                        <div class="script-actions">
                            <button class="btn-edit" data-id="1">ç¼–è¾‘</button>
                            <button class="btn-delete" data-id="1">åˆ é™¤</button>
                        </div>
                    </div>
                </div>
                <div class="widget-actions">
                    <button class="btn-add-script">+ æ·»åŠ è¯æœ¯</button>
                </div>
            </div>
            <div class="manage-panel" style="display: none;">
                <div class="manage-header">
                    <span>è¯æœ¯ç®¡ç†</span>
                    <button class="btn-close-manage">Ã—</button>
                </div>
                <div class="manage-content">
                    <div class="group-management">
                        <h4>åˆ†ç»„ç®¡ç†</h4>
                        <div class="group-list"></div>
                        <button class="btn-add-group">+ æ·»åŠ åˆ†ç»„</button>
                    </div>
                    <div class="script-management">
                        <h4>è¯æœ¯ç¼–è¾‘</h4>
                        <div class="script-form">
                            <input type="hidden" id="edit-script-id">
                            <input type="text" id="script-title" placeholder="è¯æœ¯æ ‡é¢˜">
                            <select id="script-group">
                                <option value="">é€‰æ‹©åˆ†ç»„</option>
                            </select>
                            <textarea id="script-content" placeholder="è¯æœ¯å†…å®¹"></textarea>
                            <div class="form-actions">
                                <button class="btn-save-script">ä¿å­˜</button>
                                <button class="btn-cancel-edit">å–æ¶ˆ</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // æµ‹è¯•ç®¡ç†é¢æ¿æ˜¾ç¤º
        function showManagePanel() {
            const widget = document.getElementById('chat-list-widget');
            const managePanel = widget.querySelector('.manage-panel');
            const widgetContent = widget.querySelector('.widget-content');
            
            console.log('ç®¡ç†é¢æ¿å…ƒç´ :', managePanel);
            console.log('å†…å®¹åŒºåŸŸå…ƒç´ :', widgetContent);
            console.log('ç®¡ç†é¢æ¿å½“å‰æ ·å¼:', managePanel ? managePanel.style.display : 'null');
            
            if (managePanel && widgetContent) {
                managePanel.style.display = 'block';
                widgetContent.style.display = 'none';
                console.log('ç®¡ç†é¢æ¿å·²æ˜¾ç¤ºï¼Œæ–°æ ·å¼:', managePanel.style.display);
                
                // æ£€æŸ¥ç®¡ç†é¢æ¿æ˜¯å¦çœŸçš„å¯è§
                const rect = managePanel.getBoundingClientRect();
                console.log('ç®¡ç†é¢æ¿ä½ç½®å’Œå¤§å°:', rect);
            } else {
                console.error('æ‰¾ä¸åˆ°ç®¡ç†é¢æ¿æˆ–å†…å®¹åŒºåŸŸå…ƒç´ ');
            }
        }
        
        function hideManagePanel() {
            const widget = document.getElementById('chat-list-widget');
            const managePanel = widget.querySelector('.manage-panel');
            const widgetContent = widget.querySelector('.widget-content');
            
            if (managePanel && widgetContent) {
                managePanel.style.display = 'none';
                widgetContent.style.display = 'block';
                console.log('ç®¡ç†é¢æ¿å·²éšè—');
            }
        }
        
        // ç»‘å®šäº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            
            // ç®¡ç†æŒ‰é’®
            const manageBtn = document.querySelector('.btn-manage');
            if (manageBtn) {
                manageBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»ç®¡ç†æŒ‰é’®');
                    showManagePanel();
                });
            }
            
            // å…³é—­ç®¡ç†é¢æ¿
            const closeBtn = document.querySelector('.btn-close-manage');
            if (closeBtn) {
                closeBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»å…³é—­æŒ‰é’®');
                    hideManagePanel();
                });
            }
            
            // ç¼–è¾‘æŒ‰é’®
            const editBtn = document.querySelector('.btn-edit');
            if (editBtn) {
                editBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»ç¼–è¾‘æŒ‰é’®');
                    showManagePanel();
                    // å¡«å……æµ‹è¯•æ•°æ®
                    document.getElementById('script-title').value = 'æµ‹è¯•è¯æœ¯';
                    document.getElementById('script-content').value = 'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•è¯æœ¯å†…å®¹';
                });
            }
            
            // æ·»åŠ è¯æœ¯æŒ‰é’®
            const addBtn = document.querySelector('.btn-add-script');
            if (addBtn) {
                addBtn.addEventListener('click', function() {
                    console.log('ç‚¹å‡»æ·»åŠ è¯æœ¯æŒ‰é’®');
                    showManagePanel();
                    // æ¸…ç©ºè¡¨å•
                    document.getElementById('script-title').value = '';
                    document.getElementById('script-content').value = '';
                });
            }
        });
    </script>
</body>
</html>